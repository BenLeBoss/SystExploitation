#include <stdio.h>
#include <time.h>
#include <string.h>

#include "shm-message.h"


int shm_message_copy(shm_message_t message_source, shm_message_t *message_target){
  if(!shm_message_is_empty(*message_target)){
    fprintf(stderr, "./shm-client.out:shm-message.c:9: Unable to copy the message because the target message is not empty.\n");
    return -1;
  }
  if(shm_message_set_name(message_target, message_source.name) == -1) {
    fprintf(stderr, "./shm-client.out:shm-message.c:13: Unable to copy the message because the source message name is too long.\n");
    return -1;
  }
  if(shm_message_set_text(message_target, message_source.text) == -1){
    fprintf(stderr, "./shm-client.out:shm-message.c:17: Unable to copy the message because the source message text is too long.\n");
    return -1;
  }
  return 0;
}

void shm_message_empty(shm_message_t *message){
  shm_message_set_name(message, "");
  shm_message_set_text(message, "");
}

int shm_message_is_empty(shm_message_t message){
  if ((!strcmp(message.name, "")) && (!strcmp(message.text, "")))
    return 1;
  else
    return 0;
}

void shm_message_print(shm_message_t message){
  time_t seconds = time(NULL);
  struct tm *timeinfo = localtime(&seconds);
  printf("%04d-%02d-%02d %02d:%02d:%02d: %s: %s\n",1900+timeinfo->tm_year,timeinfo->tm_mon+1,timeinfo->tm_mday,timeinfo->tm_hour,timeinfo->tm_min,timeinfo->tm_sec, message.name, message.text);
}

int shm_message_set_name(shm_message_t *message, const char *name){
  if(strlen(name) > SHM_MESSAGE_NAME_SIZE){
    fprintf(stderr, "./shm-client.out:shm-message.c:43: Unable to set the \"%s\" message name because its \"%ld\" size is greater than \"%d\".\n", name, strlen(name), SHM_MESSAGE_NAME_SIZE);
    return -1;
  }
  strcpy(message->name, name);
  return 0;
}

int shm_message_set_text(shm_message_t *message, const char *text){
  if(strlen(text) > SHM_MESSAGE_TEXT_SIZE){
    fprintf(stderr, "./shm-client.out:shm-message.c:43: Unable to set the \"%s\" message text because its \"%ld\" size is greater than \"%d\".\n", text, strlen(text), SHM_MESSAGE_TEXT_SIZE);
    return -1;
  }
  strcpy(message->text, text);
  return 0;
}
